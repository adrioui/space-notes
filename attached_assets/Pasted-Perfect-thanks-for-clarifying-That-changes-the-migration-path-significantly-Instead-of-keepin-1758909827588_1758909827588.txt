Perfect â€” thanks for clarifying ðŸš€

That changes the migration path significantly. Instead of keeping a **native WebSocket server**, weâ€™ll lean on **Supabase Realtime** for pub/sub and **Supabase Storage** for media. Drizzle ORM remains the core database access layer.

Letâ€™s lock in the **Requirements** section of the spec before moving to method details. Hereâ€™s a draft:

---

## Requirements

We are migrating from **Express.js + React (Vite)** to **Next.js 14 App Router** with the following constraints:

### Must Have

* Use **Next.js 14 App Router** as the unified framework (frontend + backend).
* **Drizzle ORM + PostgreSQL** remains the single source of truth for relational data.
* Replace native WebSocket server with **Supabase Realtime** for chat and notifications.
* Use **Supabase Storage** for file uploads (images, documents).
* Preserve OTP authentication flow (email via Nodemailer or Supabase Auth SMTP, SMS via Twilio).
* Keep all current features:

  * Space & member management (roles, invites, wallpapers).
  * Real-time group chat with reactions & threading.
  * Notes (block-based editor).
  * Lessons & progress tracking.
  * Profile customization (avatars, usernames).

### Should Have

* Replace Express sessions with **NextAuth.js (custom OTP provider)** for better integration with Next.js middleware.
* Optimize rendering using **Next.js server components** where possible.
* SEO-friendly routing for public/landing pages.

### Could Have

* Add social logins (Google, GitHub) alongside OTP.
* Use Supabase Edge Functions for offloaded background tasks (OTP cleanup, notifications).
* Implement granular caching with React Query + Next.js revalidation.

### Wonâ€™t Have (for now)

* Native WebSocket server (deprecated in favor of Supabase Realtime).
* Vite build pipeline.
* Password-based authentication.

---

ðŸ‘‰ Does this capture your intent correctly (Supabase replaces WebSocket + storage, Drizzle stays the ORM)? Or do you also want to move **all authentication** to Supabase Auth, instead of OTP + NextAuth?
